/*
THIS IS A GENERATED/BUNDLED FILE BY ROLLUP
if you want to view the source visit the plugins github repository
*/

'use strict';

var obsidian = require('obsidian');

// Remove Widgets in CodeMirror Editor
const clearWidges = (cm) => {
    var lastLine = cm.lastLine();
    for (let i = 0; i <= lastLine; i++) {
        // Get the current Line
        const line = cm.lineInfo(i);
        // Clear the image widgets if exists
        if (line.widgets) {
            for (const wid of line.widgets) {
                if (wid.className === 'oz-image-widget') {
                    wid.clear();
                }
            }
        }
    }
};
// Http, Https Link Check
const filename_is_a_link = (filename) => {
    const url_regex = /^[a-z][a-z0-9+\-.]+:/i;
    return filename.match(url_regex) != null;
};
// Image Name and Alt Text
const getFileNameAndAltText = (linkType, match) => {
    /*
       linkType 1: [[myimage.jpg|#x-small]]
       linkType2: ![#x-small](myimage.jpg)
       returns { fileName: '', altText: '' }
    */
    var file_name_regex;
    var alt_regex;
    if (linkType == 1) {
        file_name_regex = /(?<=\[\[).*(jpe?g|png|gif|svg|bmp)/;
        alt_regex = /(?<=\|).*(?=]])/;
    }
    else if (linkType == 2) {
        file_name_regex = /(?<=\().*(jpe?g|png|gif|svg|bmp)/;
        alt_regex = /(?<=\[)(^$|.*)(?=\])/;
    }
    var file_match = match[0].match(file_name_regex);
    var alt_match = match[0].match(alt_regex);
    return { fileName: file_match ? file_match[0] : '',
        altText: alt_match ? alt_match[0] : '' };
};
// Getting Active Markdown File
const getActiveNoteFile = (workspace) => {
    return workspace.getActiveFile();
};
const getPathOfVault = (vault) => {
    var path = vault.adapter.basePath;
    if (path.startsWith('/'))
        return 'app://local' + path;
    return 'app://local/' + path;
};
// Temporary Solution until getResourcePath improved 
const getPathOfImage = (vault, image) => {
    // vault.getResourcePath(image) 
    return getPathOfVault(vault) + '/' + image.path;
};
const getFileCmBelongsTo = (cm, workspace) => {
    var _a;
    let leafs = workspace.getLeavesOfType("markdown");
    for (let i = 0; i < leafs.length; i++) {
        if (leafs[i].view instanceof obsidian.MarkdownView && ((_a = leafs[i].view.sourceMode) === null || _a === void 0 ? void 0 : _a.cmEditor) == cm) {
            return leafs[i].view.file;
        }
    }
    return null;
};

// Check Single Line
const check_line = (cm, line_number, targetFile, app) => {
    // Regex for [[ ]] format
    const image_line_regex_1 = /!\[\[.*(jpe?g|png|gif|svg|bmp).*\]\]/;
    // Regex for ![ ]( ) format
    const image_line_regex_2 = /!\[(^$|.*)\]\(.*(jpe?g|png|gif|svg|bmp)\)/;
    // Get the Line edited
    const line = cm.lineInfo(line_number);
    if (line === null)
        return;
    // Current Line Comparison with Regex
    const match_1 = line.text.match(image_line_regex_1);
    const match_2 = line.text.match(image_line_regex_2);
    // Clear the widget if link was removed
    var line_image_widget = line.widgets ? line.widgets.filter((wid) => wid.className === 'oz-image-widget') : false;
    if (line_image_widget && (!match_1 || !match_2))
        line_image_widget[0].clear();
    // If any of regex matches, it will add image widget
    if (match_1 || match_2) {
        // Clear the image widgets if exists
        if (line.widgets) {
            for (const wid of line.widgets) {
                if (wid.className === 'oz-image-widget') {
                    wid.clear();
                }
            }
        }
        // Get the file name and alt text depending on format
        var filename = '';
        var alt = '';
        if (match_1) {
            // Regex for [[myimage.jpg|#x-small]] format
            filename = getFileNameAndAltText(1, match_1).fileName;
            alt = getFileNameAndAltText(1, match_1).altText;
        }
        else if (match_2) {
            // Regex for ![#x-small](myimage.jpg) format
            filename = getFileNameAndAltText(2, match_2).fileName;
            alt = getFileNameAndAltText(2, match_2).altText;
        }
        // Create Image
        const img = document.createElement('img');
        // Prepare the src for the Image
        if (filename_is_a_link(filename)) {
            img.src = filename;
        }
        else {
            // Source Path
            var sourcePath = '';
            if (targetFile != null) {
                sourcePath = targetFile.path;
            }
            else {
                let activeNoteFile = getActiveNoteFile(app.workspace);
                sourcePath = activeNoteFile ? activeNoteFile.path : '';
            }
            var image = app.metadataCache.getFirstLinkpathDest(decodeURIComponent(filename), sourcePath);
            if (image != null)
                img.src = getPathOfImage(app.vault, image);
        }
        // Image Properties
        img.alt = alt;
        // Add Image widget under the Image Markdown
        cm.addLineWidget(line_number, img, { className: 'oz-image-widget' });
    }
};
// Check All Lines Function
const check_lines = (cm, from, to, app) => {
    // Last Used Line Number in Code Mirror
    var file = getFileCmBelongsTo(cm, app.workspace);
    for (let i = from; i <= to; i++) {
        check_line(cm, i, file, app);
    }
};

class OzanImagePlugin extends obsidian.Plugin {
    constructor() {
        super(...arguments);
        // Line Edit Changes
        this.codemirrorLineChanges = (cm, change) => {
            check_lines(cm, change.from.line, change.from.line + change.text.length - 1, this.app);
        };
        // Only Triggered during initial Load
        this.handleInitialLoad = (cm) => {
            var lastLine = cm.lastLine();
            var file = getFileCmBelongsTo(cm, this.app.workspace);
            for (let i = 0; i < lastLine; i++) {
                check_line(cm, i, file, this.app);
            }
        };
    }
    onload() {
        new obsidian.Notice('Image in Editor Plugin is loaded');
        // Register event for each change
        this.registerCodeMirror((cm) => {
            cm.on("change", this.codemirrorLineChanges);
            this.handleInitialLoad(cm);
        });
    }
    onunload() {
        this.app.workspace.iterateCodeMirrors((cm) => {
            cm.off("change", this.codemirrorLineChanges);
            clearWidges(cm);
        });
        new obsidian.Notice('Image in Editor Plugin is unloaded');
    }
}

module.exports = OzanImagePlugin;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZXMiOlsic3JjL3V0aWxzLnRzIiwic3JjL2NoZWNrLWxpbmUudHMiLCJzcmMvbWFpbi50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBXb3Jrc3BhY2UsIE1hcmtkb3duVmlldywgVmF1bHQsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuXG4vLyBSZW1vdmUgV2lkZ2V0cyBpbiBDb2RlTWlycm9yIEVkaXRvclxuY29uc3QgY2xlYXJXaWRnZXMgPSAoY206IENvZGVNaXJyb3IuRWRpdG9yKSA9PiB7XG4gICAgdmFyIGxhc3RMaW5lID0gY20ubGFzdExpbmUoKTtcblxuICAgIGZvcihsZXQgaT0wOyBpIDw9IGxhc3RMaW5lOyBpKyspe1xuICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgTGluZVxuICAgICAgICBjb25zdCBsaW5lID0gY20ubGluZUluZm8oaSk7XG4gICAgICAgIC8vIENsZWFyIHRoZSBpbWFnZSB3aWRnZXRzIGlmIGV4aXN0c1xuICAgICAgICBpZiAobGluZS53aWRnZXRzKXtcbiAgICAgICAgICAgIGZvcihjb25zdCB3aWQgb2YgbGluZS53aWRnZXRzKXtcbiAgICAgICAgICAgICAgICBpZiAod2lkLmNsYXNzTmFtZSA9PT0gJ296LWltYWdlLXdpZGdldCcpe1xuICAgICAgICAgICAgICAgICAgICB3aWQuY2xlYXIoKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn1cblxuLy8gSHR0cCwgSHR0cHMgTGluayBDaGVja1xuY29uc3QgZmlsZW5hbWVfaXNfYV9saW5rID0gKGZpbGVuYW1lOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCB1cmxfcmVnZXggPSAvXlthLXpdW2EtejAtOStcXC0uXSs6L2lcbiAgICByZXR1cm4gZmlsZW5hbWUubWF0Y2godXJsX3JlZ2V4KSAhPSBudWxsXG59O1xuXG4gLy8gSW1hZ2UgTmFtZSBhbmQgQWx0IFRleHRcbmNvbnN0IGdldEZpbGVOYW1lQW5kQWx0VGV4dCA9KGxpbmtUeXBlOiBudW1iZXIsIG1hdGNoOiBhbnkpID0+IHtcbiAgICAvKiBcbiAgICAgICBsaW5rVHlwZSAxOiBbW215aW1hZ2UuanBnfCN4LXNtYWxsXV1cbiAgICAgICBsaW5rVHlwZTI6ICFbI3gtc21hbGxdKG15aW1hZ2UuanBnKSBcbiAgICAgICByZXR1cm5zIHsgZmlsZU5hbWU6ICcnLCBhbHRUZXh0OiAnJyB9ICAgXG4gICAgKi9cblxuICAgIHZhciBmaWxlX25hbWVfcmVnZXg7XG4gICAgdmFyIGFsdF9yZWdleDtcblxuICAgIGlmKGxpbmtUeXBlID09IDEpe1xuICAgICAgICBmaWxlX25hbWVfcmVnZXggPSAvKD88PVxcW1xcWykuKihqcGU/Z3xwbmd8Z2lmfHN2Z3xibXApLztcbiAgICAgICAgYWx0X3JlZ2V4ID0gLyg/PD1cXHwpLiooPz1dXSkvO1xuICAgIH0gZWxzZSBpZihsaW5rVHlwZSA9PSAyKXtcbiAgICAgICAgZmlsZV9uYW1lX3JlZ2V4ID0gLyg/PD1cXCgpLiooanBlP2d8cG5nfGdpZnxzdmd8Ym1wKS87XG4gICAgICAgIGFsdF9yZWdleCA9IC8oPzw9XFxbKSheJHwuKikoPz1cXF0pLztcbiAgICB9XG5cbiAgICB2YXIgZmlsZV9tYXRjaCA9IG1hdGNoWzBdLm1hdGNoKGZpbGVfbmFtZV9yZWdleCk7XG4gICAgdmFyIGFsdF9tYXRjaCA9IG1hdGNoWzBdLm1hdGNoKGFsdF9yZWdleCk7XG5cbiAgICByZXR1cm4geyBmaWxlTmFtZTogZmlsZV9tYXRjaCA/IGZpbGVfbWF0Y2hbMF0gOiAnJywgXG4gICAgICAgICAgICBhbHRUZXh0OiBhbHRfbWF0Y2ggPyBhbHRfbWF0Y2hbMF0gOiAnJyB9XG5cbn0gICAgXG5cbi8vIEdldHRpbmcgQWN0aXZlIE1hcmtkb3duIEZpbGVcbmNvbnN0IGdldEFjdGl2ZU5vdGVGaWxlID0gKHdvcmtzcGFjZTogV29ya3NwYWNlKSA9PiB7XG4gICAgcmV0dXJuIHdvcmtzcGFjZS5nZXRBY3RpdmVGaWxlKCk7XG59XG5cbi8vIEdldCBBY3RpdmUgRWRpdG9yXG5jb25zdCBnZXRDbUVkaXRvciA9ICh3b3Jrc3BhY2U6IFdvcmtzcGFjZSk6IENvZGVNaXJyb3IuRWRpdG9yID0+IHtcbiAgICByZXR1cm4gd29ya3NwYWNlLmdldEFjdGl2ZVZpZXdPZlR5cGUoTWFya2Rvd25WaWV3KT8uc291cmNlTW9kZT8uY21FZGl0b3Jcbn1cblxuY29uc3QgZ2V0UGF0aE9mVmF1bHQgPSAodmF1bHQ6IFZhdWx0KTogc3RyaW5nID0+IHtcbiAgICB2YXIgcGF0aCA9IHZhdWx0LmFkYXB0ZXIuYmFzZVBhdGg7XG4gICAgaWYocGF0aC5zdGFydHNXaXRoKCcvJykpIHJldHVybiAnYXBwOi8vbG9jYWwnICsgcGF0aFxuICAgIHJldHVybiAnYXBwOi8vbG9jYWwvJyArIHBhdGhcbn1cblxuLy8gVGVtcG9yYXJ5IFNvbHV0aW9uIHVudGlsIGdldFJlc291cmNlUGF0aCBpbXByb3ZlZCBcbmNvbnN0IGdldFBhdGhPZkltYWdlID0gKHZhdWx0OiBWYXVsdCwgaW1hZ2U6IFRGaWxlKSA9PiB7XG4gICAgLy8gdmF1bHQuZ2V0UmVzb3VyY2VQYXRoKGltYWdlKSBcbiAgICByZXR1cm4gZ2V0UGF0aE9mVmF1bHQodmF1bHQpICsgJy8nICsgaW1hZ2UucGF0aFxufVxuXG5jb25zdCBnZXRGaWxlQ21CZWxvbmdzVG8gPSAoY206IENvZGVNaXJyb3IuRWRpdG9yLCB3b3Jrc3BhY2U6IFdvcmtzcGFjZSkgPT4ge1xuICAgIGxldCBsZWFmcyA9IHdvcmtzcGFjZS5nZXRMZWF2ZXNPZlR5cGUoXCJtYXJrZG93blwiKTtcbiAgICBmb3IobGV0IGk9MDsgaSA8IGxlYWZzLmxlbmd0aDsgaSsrKXtcbiAgICAgICAgaWYobGVhZnNbaV0udmlldyBpbnN0YW5jZW9mIE1hcmtkb3duVmlldyAmJiBsZWFmc1tpXS52aWV3LnNvdXJjZU1vZGU/LmNtRWRpdG9yID09IGNtKXtcbiAgICAgICAgICAgIHJldHVybiBsZWFmc1tpXS52aWV3LmZpbGVcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gbnVsbDtcbn0gXG5cbmV4cG9ydCB7IGNsZWFyV2lkZ2VzLCBmaWxlbmFtZV9pc19hX2xpbmssIGdldEZpbGVOYW1lQW5kQWx0VGV4dCxcbiAgICBnZXRBY3RpdmVOb3RlRmlsZSwgZ2V0Q21FZGl0b3IsIGdldFBhdGhPZkltYWdlLCBnZXRGaWxlQ21CZWxvbmdzVG8gfTsiLCJpbXBvcnQgeyBBcHAsIFRGaWxlIH0gZnJvbSAnb2JzaWRpYW4nO1xuaW1wb3J0IHsgZ2V0RmlsZU5hbWVBbmRBbHRUZXh0LCBmaWxlbmFtZV9pc19hX2xpbmssIFxuICAgICAgICBnZXRBY3RpdmVOb3RlRmlsZSwgZ2V0UGF0aE9mSW1hZ2UsIGdldEZpbGVDbUJlbG9uZ3NUbyB9IGZyb20gJy4vdXRpbHMnO1xuXG5cbi8vIENoZWNrIFNpbmdsZSBMaW5lXG5leHBvcnQgY29uc3QgY2hlY2tfbGluZTogYW55ID0gKGNtOiBDb2RlTWlycm9yLkVkaXRvciwgbGluZV9udW1iZXI6IG51bWJlciwgdGFyZ2V0RmlsZTpURmlsZSwgYXBwOiBBcHApID0+IHtcblxuICAgIC8vIFJlZ2V4IGZvciBbWyBdXSBmb3JtYXRcbiAgICBjb25zdCBpbWFnZV9saW5lX3JlZ2V4XzEgPSAvIVxcW1xcWy4qKGpwZT9nfHBuZ3xnaWZ8c3ZnfGJtcCkuKlxcXVxcXS9cbiAgICAvLyBSZWdleCBmb3IgIVsgXSggKSBmb3JtYXRcbiAgICBjb25zdCBpbWFnZV9saW5lX3JlZ2V4XzIgPSAvIVxcWyheJHwuKilcXF1cXCguKihqcGU/Z3xwbmd8Z2lmfHN2Z3xibXApXFwpL1xuICAgIC8vIEdldCB0aGUgTGluZSBlZGl0ZWRcbiAgICBjb25zdCBsaW5lID0gY20ubGluZUluZm8obGluZV9udW1iZXIpO1xuICAgIFxuICAgIGlmKGxpbmUgPT09IG51bGwpIHJldHVybjtcblxuICAgIC8vIEN1cnJlbnQgTGluZSBDb21wYXJpc29uIHdpdGggUmVnZXhcbiAgICBjb25zdCBtYXRjaF8xID0gbGluZS50ZXh0Lm1hdGNoKGltYWdlX2xpbmVfcmVnZXhfMSk7XG4gICAgY29uc3QgbWF0Y2hfMiA9IGxpbmUudGV4dC5tYXRjaChpbWFnZV9saW5lX3JlZ2V4XzIpO1xuXG4gICAgLy8gQ2xlYXIgdGhlIHdpZGdldCBpZiBsaW5rIHdhcyByZW1vdmVkXG4gICAgdmFyIGxpbmVfaW1hZ2Vfd2lkZ2V0ID0gbGluZS53aWRnZXRzID8gbGluZS53aWRnZXRzLmZpbHRlcigod2lkOiB7IGNsYXNzTmFtZTogc3RyaW5nOyB9KSA9PiB3aWQuY2xhc3NOYW1lID09PSAnb3otaW1hZ2Utd2lkZ2V0JykgOiBmYWxzZTtcbiAgICBpZihsaW5lX2ltYWdlX3dpZGdldCAmJiAoIW1hdGNoXzEgfHwgIW1hdGNoXzIpKSBsaW5lX2ltYWdlX3dpZGdldFswXS5jbGVhcigpO1xuXG4gICAgLy8gSWYgYW55IG9mIHJlZ2V4IG1hdGNoZXMsIGl0IHdpbGwgYWRkIGltYWdlIHdpZGdldFxuICAgIGlmKG1hdGNoXzEgfHwgbWF0Y2hfMil7XG4gICAgICAgICAgICBcbiAgICAgICAgLy8gQ2xlYXIgdGhlIGltYWdlIHdpZGdldHMgaWYgZXhpc3RzXG4gICAgICAgIGlmIChsaW5lLndpZGdldHMpe1xuICAgICAgICAgICAgZm9yKGNvbnN0IHdpZCBvZiBsaW5lLndpZGdldHMpe1xuICAgICAgICAgICAgICAgIGlmICh3aWQuY2xhc3NOYW1lID09PSAnb3otaW1hZ2Utd2lkZ2V0Jyl7XG4gICAgICAgICAgICAgICAgICAgIHdpZC5jbGVhcigpXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy8gR2V0IHRoZSBmaWxlIG5hbWUgYW5kIGFsdCB0ZXh0IGRlcGVuZGluZyBvbiBmb3JtYXRcbiAgICAgICAgdmFyIGZpbGVuYW1lID0gJyc7XG4gICAgICAgIHZhciBhbHQgPSAnJztcbiAgICAgICAgXG4gICAgICAgIGlmKG1hdGNoXzEpe1xuICAgICAgICAgICAgLy8gUmVnZXggZm9yIFtbbXlpbWFnZS5qcGd8I3gtc21hbGxdXSBmb3JtYXRcbiAgICAgICAgICAgIGZpbGVuYW1lID0gZ2V0RmlsZU5hbWVBbmRBbHRUZXh0KDEsIG1hdGNoXzEpLmZpbGVOYW1lXG4gICAgICAgICAgICBhbHQgPSBnZXRGaWxlTmFtZUFuZEFsdFRleHQoMSwgbWF0Y2hfMSkuYWx0VGV4dFxuICAgICAgICB9IGVsc2UgaWYobWF0Y2hfMil7XG4gICAgICAgICAgICAvLyBSZWdleCBmb3IgIVsjeC1zbWFsbF0obXlpbWFnZS5qcGcpIGZvcm1hdFxuICAgICAgICAgICAgZmlsZW5hbWUgPSBnZXRGaWxlTmFtZUFuZEFsdFRleHQoMiwgbWF0Y2hfMikuZmlsZU5hbWVcbiAgICAgICAgICAgIGFsdCA9IGdldEZpbGVOYW1lQW5kQWx0VGV4dCgyLCBtYXRjaF8yKS5hbHRUZXh0XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIC8vIENyZWF0ZSBJbWFnZVxuICAgICAgICBjb25zdCBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcblxuICAgICAgICAvLyBQcmVwYXJlIHRoZSBzcmMgZm9yIHRoZSBJbWFnZVxuICAgICAgICBpZihmaWxlbmFtZV9pc19hX2xpbmsoZmlsZW5hbWUpKXtcbiAgICAgICAgICAgIGltZy5zcmMgPSBmaWxlbmFtZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIC8vIFNvdXJjZSBQYXRoXG4gICAgICAgICAgICB2YXIgc291cmNlUGF0aCA9ICcnO1xuICAgICAgICAgICAgaWYodGFyZ2V0RmlsZSAhPSBudWxsKXtcbiAgICAgICAgICAgICAgICBzb3VyY2VQYXRoID0gdGFyZ2V0RmlsZS5wYXRoO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgbGV0IGFjdGl2ZU5vdGVGaWxlID0gZ2V0QWN0aXZlTm90ZUZpbGUoYXBwLndvcmtzcGFjZSk7XG4gICAgICAgICAgICAgICAgc291cmNlUGF0aCA9IGFjdGl2ZU5vdGVGaWxlID8gYWN0aXZlTm90ZUZpbGUucGF0aCA6ICcnO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGltYWdlID0gYXBwLm1ldGFkYXRhQ2FjaGUuZ2V0Rmlyc3RMaW5rcGF0aERlc3QoZGVjb2RlVVJJQ29tcG9uZW50KGZpbGVuYW1lKSwgc291cmNlUGF0aCk7XG4gICAgICAgICAgICBpZihpbWFnZSAhPSBudWxsKSBpbWcuc3JjID0gZ2V0UGF0aE9mSW1hZ2UoYXBwLnZhdWx0LCBpbWFnZSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIEltYWdlIFByb3BlcnRpZXNcbiAgICAgICAgaW1nLmFsdCA9IGFsdDtcbiAgICAgICAgXG4gICAgICAgIC8vIEFkZCBJbWFnZSB3aWRnZXQgdW5kZXIgdGhlIEltYWdlIE1hcmtkb3duXG4gICAgICAgIGNtLmFkZExpbmVXaWRnZXQobGluZV9udW1iZXIsIGltZywge2NsYXNzTmFtZTogJ296LWltYWdlLXdpZGdldCd9KTsgICAgICAgICAgICBcbiAgICB9XG59XG5cbi8vIENoZWNrIEFsbCBMaW5lcyBGdW5jdGlvblxuZXhwb3J0IGNvbnN0IGNoZWNrX2xpbmVzOiBhbnkgPSAoY206IENvZGVNaXJyb3IuRWRpdG9yLCBmcm9tOiBudW1iZXIsIHRvOiBudW1iZXIsIGFwcDogQXBwKSA9PiB7XG4gICAgLy8gTGFzdCBVc2VkIExpbmUgTnVtYmVyIGluIENvZGUgTWlycm9yXG4gICAgdmFyIGZpbGUgPSBnZXRGaWxlQ21CZWxvbmdzVG8oY20sIGFwcC53b3Jrc3BhY2UpO1xuICAgIGZvcihsZXQgaT1mcm9tOyBpIDw9IHRvOyBpKyspe1xuICAgICAgICBjaGVja19saW5lKGNtLCBpLCBmaWxlLCBhcHApO1xuICAgIH1cbn0iLCJpbXBvcnQgeyBQbHVnaW4sIE5vdGljZSB9IGZyb20gJ29ic2lkaWFuJztcbmltcG9ydCB7IGNsZWFyV2lkZ2VzLCBnZXRGaWxlQ21CZWxvbmdzVG8gfSBmcm9tICcuL3V0aWxzJztcbmltcG9ydCB7IGNoZWNrX2xpbmUsIGNoZWNrX2xpbmVzIH0gZnJvbSAnLi9jaGVjay1saW5lJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgT3phbkltYWdlUGx1Z2luIGV4dGVuZHMgUGx1Z2lue1xuXG4gICAgb25sb2FkKCl7XG4gICAgICAgIG5ldyBOb3RpY2UoJ0ltYWdlIGluIEVkaXRvciBQbHVnaW4gaXMgbG9hZGVkJyk7XG4gICAgICAgIC8vIFJlZ2lzdGVyIGV2ZW50IGZvciBlYWNoIGNoYW5nZVxuICAgICAgICB0aGlzLnJlZ2lzdGVyQ29kZU1pcnJvciggKGNtOiBDb2RlTWlycm9yLkVkaXRvcikgPT4ge1xuICAgICAgICAgICAgY20ub24oXCJjaGFuZ2VcIiwgdGhpcy5jb2RlbWlycm9yTGluZUNoYW5nZXMpO1xuICAgICAgICAgICAgdGhpcy5oYW5kbGVJbml0aWFsTG9hZChjbSk7XG4gICAgICAgIH0pXG4gICAgfVxuXG4gICAgb251bmxvYWQoKXtcbiAgICAgICAgdGhpcy5hcHAud29ya3NwYWNlLml0ZXJhdGVDb2RlTWlycm9ycyggKGNtKSA9PiB7XG4gICAgICAgICAgICBjbS5vZmYoXCJjaGFuZ2VcIiwgdGhpcy5jb2RlbWlycm9yTGluZUNoYW5nZXMpO1xuICAgICAgICAgICAgY2xlYXJXaWRnZXMoY20pO1xuICAgICAgICB9KTtcbiAgICAgICAgbmV3IE5vdGljZSgnSW1hZ2UgaW4gRWRpdG9yIFBsdWdpbiBpcyB1bmxvYWRlZCcpO1xuICAgIH1cblxuICAgIC8vIExpbmUgRWRpdCBDaGFuZ2VzXG4gICAgY29kZW1pcnJvckxpbmVDaGFuZ2VzID0gKGNtOiBhbnksIGNoYW5nZTogYW55KSA9PiB7XG4gICAgICAgIGNoZWNrX2xpbmVzKGNtLCBjaGFuZ2UuZnJvbS5saW5lLCBjaGFuZ2UuZnJvbS5saW5lICsgY2hhbmdlLnRleHQubGVuZ3RoIC0gMSwgdGhpcy5hcHApO1xuICAgIH1cblxuICAgIC8vIE9ubHkgVHJpZ2dlcmVkIGR1cmluZyBpbml0aWFsIExvYWRcbiAgICBoYW5kbGVJbml0aWFsTG9hZCA9IChjbTogQ29kZU1pcnJvci5FZGl0b3IpID0+IHtcbiAgICAgICAgdmFyIGxhc3RMaW5lID0gY20ubGFzdExpbmUoKTtcbiAgICAgICAgdmFyIGZpbGUgPSBnZXRGaWxlQ21CZWxvbmdzVG8oY20sIHRoaXMuYXBwLndvcmtzcGFjZSk7XG4gICAgICAgIGZvcihsZXQgaT0wOyBpIDwgbGFzdExpbmU7IGkrKyl7XG4gICAgICAgICAgICBjaGVja19saW5lKGNtLCBpLCBmaWxlLCB0aGlzLmFwcCk7XG4gICAgICAgIH1cbiAgICB9XG59Il0sIm5hbWVzIjpbIk1hcmtkb3duVmlldyIsIlBsdWdpbiIsIk5vdGljZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBRUE7QUFDQSxNQUFNLFdBQVcsR0FBRyxDQUFDLEVBQXFCO0lBQ3RDLElBQUksUUFBUSxHQUFHLEVBQUUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztJQUU3QixLQUFJLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLElBQUksUUFBUSxFQUFFLENBQUMsRUFBRSxFQUFDOztRQUU1QixNQUFNLElBQUksR0FBRyxFQUFFLENBQUMsUUFBUSxDQUFDLENBQUMsQ0FBQyxDQUFDOztRQUU1QixJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUM7WUFDYixLQUFJLE1BQU0sR0FBRyxJQUFJLElBQUksQ0FBQyxPQUFPLEVBQUM7Z0JBQzFCLElBQUksR0FBRyxDQUFDLFNBQVMsS0FBSyxpQkFBaUIsRUFBQztvQkFDcEMsR0FBRyxDQUFDLEtBQUssRUFBRSxDQUFBO2lCQUNkO2FBQ0o7U0FDSjtLQUNKO0FBQ0wsQ0FBQyxDQUFBO0FBRUQ7QUFDQSxNQUFNLGtCQUFrQixHQUFHLENBQUMsUUFBZ0I7SUFDeEMsTUFBTSxTQUFTLEdBQUcsdUJBQXVCLENBQUE7SUFDekMsT0FBTyxRQUFRLENBQUMsS0FBSyxDQUFDLFNBQVMsQ0FBQyxJQUFJLElBQUksQ0FBQTtBQUM1QyxDQUFDLENBQUM7QUFFRDtBQUNELE1BQU0scUJBQXFCLEdBQUUsQ0FBQyxRQUFnQixFQUFFLEtBQVU7Ozs7OztJQU90RCxJQUFJLGVBQWUsQ0FBQztJQUNwQixJ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
